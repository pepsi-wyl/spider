 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>测试驱动的软件开发方式可以强迫程序员在开发程序的时候使程序的函数之间实现高内聚，低耦合。这样的方式可以降低函数之间的依赖性，方便后续的修改，增加功能和维护。</p> <p>说<strong>一个函数</strong>高内聚，就是指这个函数专注于实现单一的任务，不会做除了生产这个任务以外的其他事情。可以想象一个人，他把自己关在一个小房子里面生产东西，只留两扇窗户，他需要什么材料，你就从小窗户给他送进去（参数），他做好了东西，就给你从另一个窗户里面送出来（return），他不会说，我要生产一个轮子，但是我首先需要一个女人进来，他不会说，这是计划的一部分。</p> <p>说<strong>几个函数</strong>是低耦合的，就是指他们的依赖性小。他们就像是葫芦娃，每个都有自己独特的能力，可以自己单干，在关键的时候还可以合体，变成小金刚。他们就像积木一样，各有各的功能，需要使用的时候直接组合在一起就可以了。</p> <p>使用测试驱动开发，每一个测试只测试一个功能，这样就可以迫使函数把自己独立出来，尽量减少和其他函数的依赖。</p> <p>例如，有一个文件1.txt，他的内容是两个数字，使用逗号隔开。形如“24”（不包括外侧双引号，下同）。我要写一个程序readandadd.py，读取硬盘上的1.txt文件，然后把这个文件的内容打印到屏幕上。</p> <p>不规范的写法一：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">f= open('1.txt''r')</span><br/><span class="line">b = f.read().split('')</span><br/><span class="line">f.close()</span><br/><span class="line">print int(b[0])+int(b[1])</span><br/></pre></td></tr></table></figure></p> <p>不规范写法二：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">def A():</span><br/><span class="line">	f= open('1.txt''r')</span><br/><span class="line">	b = f.read().split('')</span><br/><span class="line">	f.close()</span><br/><span class="line">	print int(b[0])+int(b[1])</span><br/><span class="line">A()</span><br/></pre></td></tr></table></figure></p> <p>比较规范的写法：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/></pre></td><td class="code"><pre><span class="line">def read(filename):</span><br/><span class="line">    f= open(filename'r')</span><br/><span class="line">    info = f.read()</span><br/><span class="line">    f.close()</span><br/><span class="line">    return info</span><br/><span class="line"></span><br/><span class="line">def getnum(info):</span><br/><span class="line">    twonum = info.split('')</span><br/><span class="line">    return twonum</span><br/><span class="line"></span><br/><span class="line">def addnum(twonum):</span><br/><span class="line">    return int(twonum[0])+int(twonum[1])</span><br/><span class="line"></span><br/><span class="line">if __name__ == '__main__':</span><br/><span class="line">        info = read('1.txt')</span><br/><span class="line">        twonum = getnum(info)</span><br/><span class="line">        result = addnum(twonum)</span><br/><span class="line">		print result</span><br/></pre></td></tr></table></figure></p> <p>这样写的好处是，如果想测试读文件的功能，就只需要测试read()函数，如果想测试把两个数分开的功能，就只需要测试getnum()函数。而相反，在不规范写法二中，虽然只想测试两个数字相加的功能，可是却不得不首先打开文件并读取文件然后把数字分开。</p> <p>继续回到比较规范的写法当中，我相信很多人写完read()函数以后，肯定会输入如下代码：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line">def read(filename):</span><br/><span class="line">    f= open(filename'r')</span><br/><span class="line">    info = f.read()</span><br/><span class="line">    f.close()</span><br/><span class="line">    return info</span><br/><span class="line"></span><br/><span class="line">print read('1.txt')</span><br/></pre></td></tr></table></figure></p> <p>然后运行程序，发现正常打印出’23’以后，再开始写getnum()函数。写完getnum以后，测试getnum()函数没问题以后再开始写然后测试addnum()函数。最后测试整个程序的功能。</p> <p>其实这个过程，已经就是在做单元测试了。然而这样操作的弊端是什么？如果整体程序已经写好了，之前做测试点代码也就删除了。那么如果突然把程序做了修改。例如1.txt里面数字的分隔从1个逗号变成了空格，或者变成了3个数字，那必然要修改getnum()，但是又如何测试修改的部分呢？还要把不相干的代码给注释掉。不仅麻烦，而且容易出错。</p> <p>现在，把测试的代码单独独立出来。会有什么效果呢？尝试创建一个test.py程序，代码如下：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line">import readandadd</span><br/><span class="line"></span><br/><span class="line">def testread():</span><br/><span class="line">    print 'read:'readandadd.read('1.txt')</span><br/><span class="line"></span><br/><span class="line">def testgetnum():</span><br/><span class="line">    print 'getnum:'readandadd.getnum('23')</span><br/><span class="line"></span><br/><span class="line">def testaddnum():</span><br/><span class="line">    print 'addnum:'readandadd.addnum([23])</span><br/><span class="line"></span><br/><span class="line">if __name__ == '__main__':</span><br/><span class="line">    testread()</span><br/><span class="line">    testgetnum()</span><br/><span class="line">    testaddnum()</span><br/></pre></td></tr></table></figure></p> <p>运行test.py以后输出结果如下：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line">read: 23</span><br/><span class="line">getnum: ['2' '3']</span><br/><span class="line">addnum: 5</span><br/></pre></td></tr></table></figure></p> <p>每一个函数的输出结果一目了然，而且在修改了readandadd.py的函数以后，重新运行test.py就可以知道输出结果有没有符合预期。</p> <p>当然，这里这个例子非常的简单，因此可以人工通过观察test.py的输出结果来确定是否符合预期，那对于大量的函数的测试，难道也要让肉眼来看吗？当然不是。于是，下一篇文章将会介绍Python的单元测试unittest。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    