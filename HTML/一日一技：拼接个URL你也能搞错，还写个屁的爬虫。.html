 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在写爬虫的过程中，我们经常需要解析网站的列表页。</p> <p>例如下面这个例子：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220107185621.png"/></p> <p>这种情况下，我想获取每一项的URL非常简单，直接写一个XPath就可以了，如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220107185741.png"/></p> <p>仔细观察你会发现，每一个连接的URL都是以<code>http://127.0.0.1:8000</code>开头的。而当前列表页的地址也是<code>http://127.0.0.1：8000</code>。所以为了简单起见，<code>&lt;a&gt;</code>标签里面可以使用相对路径：</p> <p>运行效果如下图所示，用XPath只能提取到半截URL：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220107190417.png"/></p> <p>但是浏览器可以正确识别这样的相对地址，并且当你点击的时候，它能自动跳转到正确的地址：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220107190616.png"/></p> <p>相对路径如果是以<code>/</code>开头，那么就会在相对路径前面拼接上网站的主域名。</p> <p>但如果当前列表页的地址跟链接的相对路径有一部分重叠怎么办？如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220107190934.png"/></p> <p>当前页面的地址是<code>http://127.0.0.1:8000/book</code>。而相对地址是<code>/book/1.html</code>。这种情况下，还可以进一步简化，在相对路径的前面不要加斜杠，把HTML改成：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220107191249.png"/></p> <p>这种情况下，浏览器依然能给正确识别，如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220107191347.png"/></p> <p>浏览器知道，如果相对路径没有用<code>/</code>开头，那么它就会把当前页面的URL与相对路径拼接起来。但需要注意的是，在拼接的时候，会取最右侧斜杠左边的部分。而右边的部分会丢弃。就相当于拼接文件地址的时候，用这个文件所在的文件夹来拼接新的地址。如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220108203350.png"/></p> <p>如果你记不住怎么区分的话，你可以使用Python自带的<code>urllib.parse.urljoin</code>来连接，如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220108203722.png"/></p> <p>看到这里，你可能觉得我今天又水了一篇文章。这么简单的东西也值得写一篇文章来讲？</p> <p>那么我们来看下面这个例子：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220108204350.png"/></p> <p>域名是<code>http://127.0.0.1:8000/book/index.html</code>，相对域名是<code>1.html</code>，但为什么浏览器自动识别出来的URL是<code>www.kingname.info/1.html</code>？</p> <p>这个问题的关键，在于源代码里面的<base/>标签：</p> <p>如果HTML代码头部有<base/>标签，那么，它的<code>href</code>属性的值，会被用来跟相对路径拼接出一个绝对路径，而不会再用当前页面的URL来拼接。</p> <p>如果你不知道这一点的话，你的爬虫在拼接子页面URL的时候可能就会出问题。网站也可以使用这个机制构造出一个蜜罐，根据<base/>标签拼出来的URL才是真正的子页面地址，而用当前页面URL去拼接的URL是蜜罐地址，爬虫访问进去以后，就会抓到假数据，或者被立即屏蔽。</p> <p>关于<base/>标签的详细说明，大家可以阅读：<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base" rel="noopener" target="_blank"><base/>: The Document Base URL element</a>。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    