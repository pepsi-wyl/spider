 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在<a href="https://mp.weixin.qq.com/s?__biz=MzI2MzEwNTY3OQ==&amp;mid=2648977876&amp;idx=1&amp;sn=76c6f8d0a8dabaefe3aa3f666893c991&amp;chksm=f2506c34c527e522478a1c0e07d52075d05c2436bd326662746c1fd854ee922244dcae23b1dd&amp;token=821834861&amp;lang=zh_CN#rd" rel="noopener" target="_blank">使用 yield 压平嵌套字典有多简单？</a>这篇文章中，我们讲到，要把一个多层嵌套的字典压平，可以使用<code>yield</code>关键字来实现。</p> <p>今天，我们倒过来，把一个已经被压平的字典还原成嵌套字典。</p> <p>目标字典为：</p> <p>我们要把它还原为：</p> <p>要实现这个需求，我们分成两个主要的步骤。</p> <p>对于<code>{'a_b_h':1}</code>，它实际上被还原以后应该是：</p> <p>现在，写一个函数<code>unpack</code>，这个函数的作用是传入两个参数<code>['a' 'b' 'h']</code>和<code>1</code>输出<code>{'a': {'b': {'h': 1}}}</code>：</p> <p>需要注意的是，<code>unpack</code>函数的第一个参数是一个列表，形如：<code>['a' 'b' 'h']</code>。运行效果如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-12-20-20-29-10.png"/></p> <p>这个函数使用递归，把第一个参数列表一项一项拿出来，作为字典的 key，并把剩下的项作为子字典的 key。当列表只剩一个值的时候，说明已经到了最里面了，把这个值作为最里面字典的 key，第二个参数作为 value。</p> <p>接下来，我们实现第二个函数<code>deflat</code>，它把目标字典分成<code>key value</code>对，并把 key 转换为列表以后传给<code>unpack</code>函数：</p> <p>在 <code>deflat</code>函数中，我们传入目标字典。目标字典的每一对 <code>key value</code>被取出来，传入<code>unpack</code>函数构造每一个小的嵌套字典。</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-12-20-20-43-03.png"/></p> <p>有了每一个嵌套字典以后，我们要做的就是把他们合并起来。</p> <p>假设我们有两个字典：dst 和 src，把 src 的内容合并到 dst 字典中，有如下几种情况。</p> <p>假设<code>dst = {'a': 1}</code>，<code>src = {'b': 1}</code>，那么合并以后，<code>dst</code>变成<code>{'a': 1 'b': 1}</code>。</p> <p>对应代码如下：</p> <p>假设<code>dst = {'a': {'b': 1}}</code>， <code>src = {'a': {'c': 1}}</code>，那么由于<code>dst</code>与<code>src</code>都有<code>'a'</code>这个 key，所以问题转换为合并<code>{'b': 1}</code>和<code>{'c': 1}</code>，变成第一种情况。</p> <p>对应代码如下：</p> <p>在本题中，这种情况不存在，因为这会导致目标字典有相同的 key。但是字典是不能重复的。</p> <p>这种情况下说明目标字典有问题，无法合并。</p> <p>例如:</p> <p>这种字典不存在嵌套写法，因为<code>{'a': 3}</code>与<code>{'a': {'b': {'c': 1}}}</code>只能互相覆盖，不能合并。</p> <p><code>merge</code>函数的完整写法如下：</p> <p>最后我们来解答这个问题，把三个函数结合起来。运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-12-20-21-00-23.png"/></p> <p>当传入不能被转换的目标字典时，也会正常报错</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-12-20-21-01-43.png"/></p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    