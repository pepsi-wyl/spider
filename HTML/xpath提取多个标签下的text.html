 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在写爬虫的时候，经常会使用xpath进行数据的提取，对于如下的代码：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">&lt;div id="test1"&gt;大家好！&lt;/div&gt;</span><br/></pre></td></tr></table></figure></p> <p>使用xpath提取是非常方便的。假设网页的源代码在selector中：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">data = selector.xpath('//div[@id="test1"]/text()').extract()[0]</span><br/></pre></td></tr></table></figure></p> <p>就可以把“大家好！”提取到data变量中去。</p> <p>然而如果遇到下面这段代码呢？<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">&lt;div id="test2"&gt;美女，&lt;font color=red&gt;你的微信是多少？&lt;/font&gt;&lt;div&gt;</span><br/></pre></td></tr></table></figure></p> <p>如果使用：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">data = selector.xpath('//div[@id="test2"]/text()').extract()[0]</span><br/></pre></td></tr></table></figure></p> <p>只能提取到“美女，”；</p> <p>如果使用：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">data = selector.xpath('//div[@id="test2"]/font/text()').extract()[0]</span><br/></pre></td></tr></table></figure></p> <p>又只能提取到“你的微信是多少？”</p> <p>可是我本意是想把“美女，你的微信是多少？”这一整个句子提取出来。</p> <p>这还不是最糟糕的，还有第三段代码：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">&lt;div id="test3"&gt;我左青龙，&lt;span id="tiger"&gt;右白虎，&lt;ul&gt;上朱雀，&lt;li&gt;下玄武。&lt;/li&gt;&lt;/ul&gt;老牛在当中，&lt;/span&gt;龙头在胸口。&lt;div&gt;</span><br/></pre></td></tr></table></figure></p> <p>而且内部的标签还不固定，如果我有一百段这样类似的html代码，又如何使用xpath表达式，以最快最方便的方式提取出来？</p> <p>我差一点就去用正则表达式替换了。还好我去Stack Overflow上面提了问。于是很快就有人给我解答了。</p> <p><strong>使用xpath的string(.)</strong></p> <p>以第三段代码为例：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">data = selector.xpath('//div[@id="test3"]')</span><br/><span class="line">info = data.xpath('string(.)').extract()[0]</span><br/></pre></td></tr></table></figure></p> <p>这样，就可以把“我左青龙，右白虎，上朱雀，下玄武。老牛在当中，龙头在胸口”整个句子提取出来，赋值给info变量。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    