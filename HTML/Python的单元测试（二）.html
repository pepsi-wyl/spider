 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在<a href="http://kingname.info/2015/02/27/Python%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" rel="noopener" target="_blank">Python的单元测试（一）</a>中，我们讲了单元测试的概念以及一个简单的单元测试例子。</p> <p>在这个例子中，只有三个函数，于是可以把每个函数的输出结果打印到屏幕上，再用肉眼去看结果是否符合预期。然而假设有一个程序，有二十个类，每个类又有几十个函数，有些函数的输出结果还多达几十行，在这种情况下，肉眼如何看得出？</p> <p>当然你可以使用if判断<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 输出结果 == 预期结果:</span><br/><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br/><span class="line"><span class="keyword">else</span>:</span><br/><span class="line">	<span class="keyword">print</span> <span class="string">u'不相等'</span></span><br/></pre></td></tr></table></figure></p> <p>这个时候，你发现，程序有几个函数，后三行就要重复几次，本着代码简洁的原则，你把这个判断的过程写到一个函数中：<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isequal</span><span class="params">(outputright_output)</span>:</span></span><br/><span class="line">	<span class="keyword">if</span> output == right_output:</span><br/><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br/><span class="line">	<span class="keyword">else</span>:</span><br/><span class="line">		<span class="keyword">print</span> <span class="string">u'不相等'</span></span><br/></pre></td></tr></table></figure></p> <p>那么恭喜你，你步入正规了，然而，这一切已经有人为你做好了。欢迎unittest模块出场。</p> <p>unittest supports test automation sharing of setup and shutdown code for tests aggregation of tests into collections and independence of the tests from the reporting framework. The unittest module provides classes that make it easy to support these qualities for a set of tests.</p> <p>Python的官方文档这样写到，unittest支持自动化测试，测试的安装分享和关闭代码……</p> <p>一句话说来，就是，unittest很好用。</p> <p>还是用上一次的readandadd.py来演示unittest的基本用法首先介绍unittest的一个函数，assertEqual(firstsecond)这个函数的作用是检查变量first的值与second的值是否相等，如果不相等就抛出错误。 </p> <p>先创建utest.py文件，输入以下代码并运行：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/></pre></td><td class="code"><pre><span class="line">#-*-coding:utf-8-*-</span><br/><span class="line">import unittest</span><br/><span class="line">import readandadd</span><br/><span class="line"></span><br/><span class="line">class basictest(unittest.TestCase): #类名可以随便取</span><br/><span class="line">    def testread(self): #每个函数都要以test开头</span><br/><span class="line">        output = readandadd.read('1.txt')</span><br/><span class="line">        self.assertEqual(output'23')</span><br/><span class="line"></span><br/><span class="line">    def testgetnum(self):</span><br/><span class="line">        output = readandadd.getnum('23')</span><br/><span class="line">        self.assertEqual(output['2' '3'])</span><br/><span class="line"></span><br/><span class="line">    def testaddnum(self):</span><br/><span class="line">        output = readandadd.addnum([23])</span><br/><span class="line">        self.assertEqual(output5)</span><br/><span class="line"></span><br/><span class="line">if __name__ == '__main__':</span><br/><span class="line">    unittest.main()</span><br/></pre></td></tr></table></figure></p> <p>运行结果如下：<br/><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">...</span><br/><span class="line">----------------------------------------------------------------------</span><br/><span class="line">Ran 3 tests <span class="keyword">in</span> 0.001s</span><br/><span class="line"></span><br/><span class="line">OK</span><br/></pre></td></tr></table></figure></p> <p>你也许会说，就一个ok，什么都没有啊。那我先把testread()函数下面的<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">self.assertEqual(output<span class="string">'23'</span>)</span><br/></pre></td></tr></table></figure></p> <p>改为<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">self.assertEqual(output<span class="string">'24'</span>)</span><br/></pre></td></tr></table></figure></p> <p>在运行utest.py看看输出结果如何：<br/><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/></pre></td><td class="code"><pre><span class="line">..F</span><br/><span class="line">======================================================================</span><br/><span class="line">FAIL: testread (__main__.basictest)</span><br/><span class="line">----------------------------------------------------------------------</span><br/><span class="line">Traceback (most recent call last):</span><br/><span class="line">  File <span class="string">"E:/mystuff/unitest/utest.py"</span> line 8 <span class="keyword">in</span> testread</span><br/><span class="line">    self.assertEqual(output<span class="string">'24'</span>)</span><br/><span class="line">AssertionError: <span class="string">'23'</span> != <span class="string">'24'</span></span><br/><span class="line"></span><br/><span class="line">----------------------------------------------------------------------</span><br/><span class="line">Ran 3 tests <span class="keyword">in</span> 0.000s</span><br/><span class="line"></span><br/><span class="line">FAILED (failures=1)</span><br/></pre></td></tr></table></figure></p> <p>这里准确的找出了错误的位置和错误的具体内容。注意看最上面，有个<br/><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">..F</span><br/></pre></td></tr></table></figure></p> <p>猜测它可能是标示错误的位置。保持testread的错误不改，再把testgetnum()函数中的以下内容<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">self.assertEqual(output[<span class="string">'2'</span> <span class="string">'3'</span>])</span><br/></pre></td></tr></table></figure></p> <p>改为<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">self.assertEqual(output[<span class="string">'2'</span> <span class="string">'6'</span>])</span><br/></pre></td></tr></table></figure></p> <p>再运行utest.py程序，输出结果如下：<br/><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/></pre></td><td class="code"><pre><span class="line">.FF</span><br/><span class="line">======================================================================</span><br/><span class="line">FAIL: testgetnum (__main__.basictest)</span><br/><span class="line">----------------------------------------------------------------------</span><br/><span class="line">Traceback (most recent call last):</span><br/><span class="line">  File <span class="string">"E:/mystuff/unitest/utest.py"</span> line 12 <span class="keyword">in</span> testgetnum</span><br/><span class="line">    self.assertEqual(output[<span class="string">'2'</span> <span class="string">'6'</span>])</span><br/><span class="line">AssertionError: Lists differ: [<span class="string">'2'</span> <span class="string">'3'</span>] != [<span class="string">'2'</span> <span class="string">'6'</span>]</span><br/><span class="line"></span><br/><span class="line">First differing element 1:</span><br/><span class="line">3</span><br/><span class="line">6</span><br/><span class="line"></span><br/><span class="line">- [<span class="string">'2'</span> <span class="string">'3'</span>]</span><br/><span class="line">?        ^</span><br/><span class="line"></span><br/><span class="line">+ [<span class="string">'2'</span> <span class="string">'6'</span>]</span><br/><span class="line">?        ^</span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line">======================================================================</span><br/><span class="line">FAIL: testread (__main__.basictest)</span><br/><span class="line">----------------------------------------------------------------------</span><br/><span class="line">Traceback (most recent call last):</span><br/><span class="line">  File <span class="string">"E:/mystuff/unitest/utest.py"</span> line 8 <span class="keyword">in</span> testread</span><br/><span class="line">    self.assertEqual(output<span class="string">'24'</span>)</span><br/><span class="line">AssertionError: <span class="string">'23'</span> != <span class="string">'24'</span></span><br/><span class="line"></span><br/><span class="line">----------------------------------------------------------------------</span><br/><span class="line">Ran 3 tests <span class="keyword">in</span> 0.001s</span><br/><span class="line"></span><br/><span class="line">FAILED (failures=2)</span><br/></pre></td></tr></table></figure></p> <p>可以看出，这里分别把两个错误显示了出来。并且第一行变成了<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">.FF</span><br/></pre></td></tr></table></figure></p> <p>所以，第一行的内容应该从右往左读，它标明错误函数在所有函数的相对位置。</p> <p>现在再把testread()和testgetnum()改回去，再看看全部正确的输出：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">...</span><br/><span class="line">----------------------------------------------------------------------</span><br/><span class="line">Ran 3 tests in 0.000s</span><br/><span class="line"></span><br/><span class="line">OK</span><br/></pre></td></tr></table></figure></p> <p>印证了那句话，没有消息就是最好的消息。</p> <p>这篇文章介绍了单元测试模块unittest的assertEqual的基本用法，下一篇文章将要更加全面的介绍unittest模块。</p> <p>本文首发地址:<a href="http://kingname.info/2015/03/04/pythonunittest2/" rel="noopener" target="_blank">http://kingname.info/2015/03/04/pythonunittest2/</a></p> <p>作者：青南　</p> <p>转载请注明出处。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    