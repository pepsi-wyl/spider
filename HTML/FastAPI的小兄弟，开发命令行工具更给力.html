 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>关注我公众号的同学都知道，我非常喜欢FastAPI这个web框架。它在易用性上面做到了极致，帮助开发者减少了很多不必要的工作。</p> <p>FastAPI的开发组织叫做<code>tiangolo</code>，他家除了FastAPI外，还有另一个项目也非常好用，叫做<code>typer</code>。</p> <p>三年前，我写过一篇文章<a href="https://mp.weixin.qq.com/s/lO42vHaYz1TToiUO8Q2wcQ" rel="noopener" target="_blank">一日一技：快速实现Python 命令行参数</a>介绍另一个命令行工具fire. 而<code>typer</code>做得比fire还要好。</p> <p>首先使用pip来安装它：</p> <p>我们首先来看看typer怎么使用。创建一个<code>example_1.py</code>文件，写入如下代码。</p> <p>直接运行，Python会报错：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119182532.png"/></p> <p>使用参数<code>--help</code>可以查看这个脚本的命令行参数：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119182619.png"/></p> <p>于是我们根据这里的提示，输入正确的参数，从而正常运行程序：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119182659.png"/></p> <p>假设我们有一个神经网络的程序，其中的入口函数代码如下：</p> <p>显然，这个程序可以用来训练数据，也可以用来预测数据，所以有两种不同的命令，每一种命令有不同的参数。</p> <p>这种情况下，使用typer非常方便，只需要加两个装饰器就可以了：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119183543.png"/></p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119183621.png"/></p> <p>输入具体的子命令，还可以查看每个子命令的参数：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119183725.png"/></p> <p>因此，我可以使用两个不同的子命令来运行程序：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119185959.png"/></p> <p>你以为这样就完了？我们再安装它的一个辅助工具<code>typer-cli</code>，还可以做更多事情：</p> <p>有了这个东西，我们运行程序可以这样写：</p> <p>例如：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119184434.png"/></p> <p>并且，typer可以帮我们可以实现自动补全：</p> <p>输入<code>typer example_2.py run</code> 然后按下<code>Tab</code>键，自动告诉你可以输入哪些子命令，如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119184218.png"/></p> <p>除此之外，如果你的命令行程序只有一个命令，那么你甚至只需要写一个函数，连typer都不需要导入，就可以使用typer来运行：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119184837.png"/></p> <p>我们知道，FastAPI自动生成接口文档的功能非常好用。typer作为它的兄弟，也继承了这个高级功能。我们来看看：</p> <p>运行命令：</p> <p>自动在当前文件夹生成一个<code>readme.md</code>文件。我们使用任何能够渲染Markdown的软件打开这个文档，可以看到文档内容如下：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220119185537.png"/></p> <p>这样一来，我们不需要额外花心思去维护文档，只需要在修改完代码、增删新的命令或者参数以后，运行这个命令，就可以把文档自动更新。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    