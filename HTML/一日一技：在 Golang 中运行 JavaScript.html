 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>我们知道，在 Python 里面，如果你要运行一段 JavaScript，你可以使用<code>execJS</code>这种第三方库。那么在 Golang 里面，你想运行 JavaScript 的时候又应该怎么办呢？</p> <p>最近我发现一个使用 Golang 开发的 JavaScript 引擎：<a href="https://github.com/dop251/goja" rel="noopener" target="_blank">Goja</a>。它实现了<code>ES 5.1</code>的所有语法和大部分的<code>ES 6</code>语法，比 Python 的<code>execJS</code>要厉害得多。在一定程度上和特定场景下，它可以完全替代Chrome 的 V8引擎。</p> <p>我们来看看如使用它运行一段 JavaScript 代码。首先，我来写一段递归版的 JavaScript 代码计算斐波那契数列：</p> <p>直接在浏览器上面运行的效果如下：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220118194307.png"/></p> <p>现在，我们来安装这个<code>Goja</code>：</p> <p>接下来我们在 Go 中运行 js 代码：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220118195256.png"/></p> <p>我们来解释一下上面代码的意思。请大家关注截图中的代码行号。第19行，我们创建了一个 JavaScript 的虚拟机。然后在第20行，把这个函数加载到了虚拟机当中。</p> <p>第25行，我们创建了一个变量，这个变量是函数类型，这个函数接收一个 <code>int32</code>作为参数，并返回另一个<code>int32</code>类型的数据。</p> <p>第26行，我们把 Golang 里面的这个函数变量与 JavaScript 里面的函数<code>fib</code>关联起来，这样我们就能直接写 Go 代码来调用 JavaScript 代码了。</p> <p>第31行，我们像调用普通的 Go 函数一样传入参数，然后获得结果。</p> <p>有一些同学在做爬虫的时候，需要运行一段 JavaScript 代码来生成一段 token，那你不妨试一试<code>Goja</code>，它的速度肯定要比你用Python 版本的快很多。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    