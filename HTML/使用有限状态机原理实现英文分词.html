 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>使用Python开发一个英文句子分词程序，把一段英文句子切分为每一个单词。不能导入任何官方的或者第三方的库，也不能使用字符串的split()方法。</p> <p>对于只有单词和空格，不含其他符号的英语句子，可以使用空格来切分单词。于是对于句子<code>I am kingname</code> 一个字符一个字符的进行遍历。首先遍历到<code>I</code>，发现它是一个字母，于是把它存到一个变量<code>word</code>中，然后遍历到空格，于是把变量<code>word</code>的值添加到变量<code>word_list</code>中，再把<code>word</code>清空。接下来遍历到字母<code>a</code>，又把<code>a</code>放到变量<code>word</code>中。再遍历到<code>m</code>，发现它还是一个字母，于是把字母<code>m</code>拼接到变量<code>word</code>的末尾。此时变量<code>word</code>的值为<code>am</code>。再遍历到第二个空格，于是把<code>word</code>的值添加到<code>word_list</code>中，清空<code>word</code>。</p> <p>最后，由于第三个单词<code>kingname</code>的末尾没有空格，所以需要手动把它添加到列表<code>word_list</code>中。</p> <p>完整的代码如下：</p> <p>运行效果如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-03-28.png"/></p> <p>现在不仅仅只有单词和空格，还有逗号和句号。有这样一个句子：”I am kingnameyou should remember me.”如果使用上一小节的程序，那么代码就会出现问题，如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-04-07.png"/></p> <p>其中，”kingnameyou”应该是两个单词，但是在这里变成了一个单词。所以现在不仅遇到空格要进行切分，遇到逗号句号还需要进行切分。那么对代码做一些修改，变成如下代码：</p> <p>现在运行起来看上去没有问题了，如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-06-53.png"/></p> <p>然而，有些人写英文的时候喜欢在标点符号右侧加一个空格，例如：”I am kingname you should remember me.”这样小小的一修改，上面的代码又出问题了，如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-09-39.png"/></p> <p>分词出来的结果里面凭空多出来一个空字符串。为了解决这个问题，再加一层判断，只有发现<code>word</code>不为空字符串的时候才把它加入到<code>word_list</code>中，代码继续修改：</p> <p>代码看起来又可以正常工作了。如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-12-26.png"/></p> <p>标点符号可不仅仅只有逗号句号。现在又出现了冒号分号双引号感叹号问号等等杂七杂八的符号。英文句子变为：”I am kingname you should say: “Kingname Oba” to me will you?”</p> <p>使用上面的代码，发现运行起来又出问题了。如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-21-15.png"/></p> <p>为了能覆盖到所有的标点符号，现在修改一下逻辑。原来是“遇到空格/逗号/句号”就把<code>word</code>放到<code>word_list</code>中。现在要改为“如果当前字符不是字母，就把<code>word</code>放到<code>word_list</code>中”。于是代码进一步做修改：</p> <p>代码修改以后又可以正常工作了，其运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-24-52.png"/></p> <p>如果双引号包含的句子里面还需要用到引号，那么就需要在内部使用单引号。例如有这样一个句子：“I am kingname you should say: “Kingname Oba I always remember your motto: ‘kingname is genius’” to me will you?”</p> <p>使用前面的代码，运行起来似乎没有问题，如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-36-20.png"/></p> <p>但是，单引号还有其他用途——有人喜欢把两个单词合并成一个单词，例如：</p> <p>在这种情况下，就应该把单引号连接的两部分看作是一个单词，不应该把它们切开。</p> <p>如果句子变成：<code>I'm kingname you should say: "Kingname Oba I always remember your motto: 'kingname's genius'" to me won't you?</code>继续使用上面的代码，就发现返回的单词列表又不对了。如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-13-42-16.png"/></p> <p>要解决这个问题，就需要确定单引号具体是做普通的引号来使用，还是放在缩写里使用。</p> <p>作为普通单引号使用的时候，如果是前单引号，那么它的左边必定不是字母，如果作为后单引号，那么它的右边必定不是字母。而缩写里面的单引号，它左右两侧必定都是字母。并且需要注意，如果是句子里面第一个符号就是单引号，那么此时它左边没有字符；如果句子里面最后一个符号是单引号，那么它右边没有字符，此时如果使用下标来查找，就需要当心下标越界。</p> <p>对代码进一步修改：</p> <p>现在代码又可以成功运行了，如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-14-13-43.png"/></p> <p>但是请细看代码，现在已经混乱到难以阅读难以理解了。如果再增加一个连字符又怎么改？如果单词内部出现了两个单引号怎么改？这种为了增加一个功能，要把很多不相干代码也进行修改的编码方式，相信可以击中很多初学者甚至是不少自称为软件工程师的人。</p> <p>根据分词逻辑，遇到各种符号应该怎么处理，画一个分词的状态转移图出来。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/split_fms3.png"/></p> <p>从这个图上可以看出来，其实程序只需要知道当前是什么状态，以及遇到什么字符需要转移到什么状态就可以了。没有必要知道自己是从哪个状态转移过来的，也没有必要知道和自己不相干的其他状态。</p> <p>举一个例子：<code>I'm kingname you should say: "Kingname Oba I always remember your motto: 'kingname's genius'" to me won't you?</code>这个句子中，<code>should</code>这个单词就是处于“单词状态”。它不在单引号内部，它也不是一个缩写。当我们对句子每个字符进行遍历的时候，遍历到“should”的“s”时进入“单词状态”，在单词状态，只需要关心接下来过来的下一个字符是什么，如果是字母，那依然是单词状态，把字母直接拼接上来即可。如果是单引号，那么进入“单引号在单词中状态”。至于“单引号在单词中状态”有什么逻辑，单词状态的代码根本不需要知道。这就像是接力赛，我把棒交给下一个人，我的任务就做完了，下一个人是跑到终点还是爬到终点，都和我没有关系。</p> <p>这就是有限状态机FSM的原理。</p> <p>根据这个原理，使用状态和转移关系来改写代码，就可以让代码的逻辑变得非常清晰。改进以后的代码如下：<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spliter</span><span class="params">(object)</span>:</span></span><br/><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br/><span class="line">        self.constant = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></span><br/><span class="line">        self.state = <span class="string">'初始状态'</span></span><br/><span class="line">        self.word = <span class="string">''</span></span><br/><span class="line">        self.word_list = []</span><br/><span class="line">        self.state_dict = {<span class="string">'初始状态'</span>: self.parse_init</span><br/><span class="line">                           <span class="string">'单词状态'</span>: self.parse_word</span><br/><span class="line">                           <span class="string">'单引号在单词中状态'</span>: self.parse_contraction}</span><br/><span class="line"></span><br/><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_init</span><span class="params">(self letter)</span>:</span></span><br/><span class="line">        <span class="keyword">if</span> letter <span class="keyword">in</span> self.constant:</span><br/><span class="line">            self.state = <span class="string">'单词状态'</span></span><br/><span class="line">            self.word += letter</span><br/><span class="line"></span><br/><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_word</span><span class="params">(self letter)</span>:</span></span><br/><span class="line">        <span class="keyword">if</span> letter <span class="keyword">in</span> self.constant:</span><br/><span class="line">            self.word += letter</span><br/><span class="line">        <span class="keyword">elif</span> letter == <span class="string">"'"</span>:</span><br/><span class="line">            self.state = <span class="string">'单引号在单词中状态'</span></span><br/><span class="line">            self.word += <span class="string">"'"</span></span><br/><span class="line">        <span class="keyword">else</span>:</span><br/><span class="line">            self.word_list.append(self.word)</span><br/><span class="line">            self.state = <span class="string">'初始状态'</span></span><br/><span class="line">            self.word = <span class="string">''</span></span><br/><span class="line"></span><br/><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_contraction</span><span class="params">(self letter)</span>:</span></span><br/><span class="line">        <span class="keyword">if</span> letter <span class="keyword">in</span> self.constant:</span><br/><span class="line">            self.word += letter</span><br/><span class="line">            self.state = <span class="string">'单词状态'</span></span><br/><span class="line">        <span class="keyword">else</span>:</span><br/><span class="line">            self.word_list.append(self.word[:<span class="number">-1</span>])</span><br/><span class="line">            self.word = <span class="string">''</span></span><br/><span class="line">            self.state = <span class="string">'初始状态'</span></span><br/><span class="line"></span><br/><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(self target)</span>:</span></span><br/><span class="line">        <span class="keyword">for</span> letter <span class="keyword">in</span> target:</span><br/><span class="line">            self.state_dict[self.state](letter)</span><br/><span class="line"></span><br/><span class="line">        <span class="keyword">return</span> self.word_list</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br/><span class="line">    spliter = Spliter()</span><br/><span class="line">    sentence = <span class="string">'''I'm kingname you should say: "Kingname Oba </span></span><br/><span class="line"><span class="string">                      I always remember your motto: 'kingname's genius'" to me won't you?'''</span></span><br/><span class="line">    print(spliter.split(sentence))</span><br/></pre></td></tr></table></figure></p> <p>代码运行效果如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2017-12-10-15-50-27.png"/></p> <p>需要注意的是，图中的代码只是使用了有限状态机的原理，而并非一个有限状态机。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    