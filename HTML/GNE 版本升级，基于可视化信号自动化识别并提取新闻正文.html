 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-10-07-16-05-00.png"/></p> <p>GNE 是一个通用的新闻正文抽取器，自从开源以来，已经被很多人用来作为新闻正文通用爬虫的重要组件。</p> <p>GNE 的 Github 地址：<a href="https://github.com/GeneralNewsExtractor/GeneralNewsExtractor" rel="noopener" target="_blank">https://github.com/GeneralNewsExtractor/GeneralNewsExtractor</a>。算法来自于<a href="https://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CJFQ&amp;dbname=CJFDLAST2019&amp;filename=GWDZ201908029&amp;v=MDY4MTRxVHJXTTFGckNVUkxPZmJ1Wm5GQ2poVXJyQklqclBkTEc0SDlqTXA0OUhiWVI4ZVgxTHV4WVM3RGgxVDM=" rel="noopener" target="_blank">《基于文本及符号密度的网页正文提取方法》</a>，这个算法是完全基于 HTML 里面的信息来寻找正文。因此，它有一些先天性缺陷：</p> <p>但如果让人来看网页，就不会搞错。因为正文的位置和评论的位置肯定不一样，版权信息一般在最下面……这些可视化信号，是通过 CSS 来确定的，单纯从 HTML 中是看不到的。</p> <p>GNE 输入的HTML，原本就是使用模拟浏览器输出的 HTML，并不是真正的网页源代码。既然如此，在使用模拟浏览器的时候，为什么不直接把每个节点的坐标信息都记录下来呢？在使用模拟浏览器的时候，只需要执行一段 JavaScript 代码，就可以把每个节点是否可见，每个可见节点的长宽高、左上角、右下角的坐标记录下来。这样，GNE 在解析正文的时候，可以参考这些信息，直接移除不可见的节点，并移除尺寸显然不合理、位置显然不正确的节点。从而大大提高正文识别的准确率。</p> <p>基于可视化信号的提取效果如何呢？我们用一篇新闻来作为例子：<a href="https://www.163.com/dy/article/G33O1QTA05372UZS.html" rel="noopener" target="_blank">广西省发生了一起事件，位置在来宾市，画面曝光</a>。</p> <p>首先在浏览器的开发者工具里面，直接复制经过js 渲染后的源代码：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-10-07-15-44-28.png"/></p> <p>当我们直接使用 GNE识别正文的时候，运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-10-07-15-46-34.png"/></p> <p>可以看到，提取到的信息是版权信息。</p> <p>现在，如果使用经过修改的 HTML 代码，就能成功提取到正文，如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-10-07-15-47-43.png"/></p> <p>那么，这个经过修改的 HTML 有什么特别呢？我们来看看它长什么样：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-10-07-15-48-39.png"/></p> <p>在<code>body</code> 标签下面的所有节点，都有一个属性叫做 <code>is_visiable</code> ，它的值是字符串的 <code>true</code> 或者 <code>false</code> 。如果值为 <code>true</code> <br/>那么，还有一个属性叫做 <code>coordinate</code> 。它的值是一个 JSON 字符串，包含了这个节点的尺寸，坐标等信息。</p> <p>那么，这些特殊的 HTML 是怎么生成的呢？如果你只是想做一个临时测试，那么其实只需要在Chrome 的开发者工具的<code>Console(控制台)</code>标签页执行这样一段 js 代码就可以了：</p> <p>如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-10-07-15-53-51.png"/></p> <p>执行完成以后，重新打开<code>Elements(元素)</code>标签页，就可以看到我们需要的属性已经添加到了各个节点里面。</p> <p>如果你想要使用 Puppeteer 或者 Selenium 来实现同样爬虫，想批量自动化执行 JavaScript，我给出一个 Demo，大家可以参考：<a href="https://github.com/GeneralNewsExtractor/GneRender" rel="noopener" target="_blank">GitHub - GeneralNewsExtractor/GneRender: Render web page to add necessary info on every dom element.</a>.</p> <p>只需要执行如下几个命令：</p> <p>就可以在当前文件夹下面生成一个<code>test.html</code>，就这是经过修改的特殊 HTML 了。</p> <p>最新版本的 GNE 已经提交到了 Pypi，大家现在可以直接试用 pip 安装：</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    