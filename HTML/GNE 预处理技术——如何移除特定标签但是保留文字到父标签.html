 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在开发新闻网页正文通用抽取器<a href="https://github.com/kingname/GeneralNewsExtractor" rel="noopener" target="_blank">GNE</a>的过程中，需要对目标网页的源代码进行一些预处理，从而提高正文抓取的准确性。其中之一就是把 <code>&lt;p&gt;</code>标签内部的 <code>&lt;span&gt;</code>标签中的文本，合并到<code>&lt;p&gt;</code>标签中，再删除 <code>&lt;span&gt;</code> 标签。</p> <p>例如：</p> <p>需要转换为：</p> <p>在原来做定向爬虫的时候，这本不是什么问题，因为使用 XPath 可以直接提取所有内容：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-09-22-17-03-43.png"/></p> <p>但在通用新闻抽取器里面不能这样写。因为并不是所有的<code>&lt;p&gt;</code>标签中的内容都是新闻正文。GNE 有一套算法来计算并寻找全部包含真正有效内容的<code>&lt;p&gt;</code>标签。这就要求在预处理阶段，需要把 <code>&lt;p&gt;</code>标签里面的<code>&lt;span&gt;</code>标签合并到<code>&lt;p&gt;</code>标签里面。</p> <p>可能有人的第一反应是：先把 <code>&lt;p&gt;</code> 标签里面的内容提取出来，然后再把 <code>&lt;span&gt;</code> 标签里面的内容提取出来，并添加到 <code>&lt;p&gt;</code> 标签中。这不就解决问题了吗？</p> <p>但实际上并没有这么简单。以上面的 HTML 代码为了，如果按照这种简单的解法，那么分别提取以后会得到如下内容：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-09-22-17-11-59.png"/></p> <p>现在问题来了，你怎么知道 <code>&lt;span&gt;</code> 标签中提取出来的这两个字符串<code>世界</code> <code>产品经理</code>，分别应该插入到 <code>&lt;p&gt;</code> 标签结果列表中的哪个位置？所以这种方案并不可取。</p> <p>那么又有人问，能不能使用 XPath 的<code>string</code>关键字把 <code>&lt;p&gt;</code> 标签下面的所有文本直接提取出来，再作处理呢？这样不就可以忽略标签差异了吗？在上面的 html 代码中，这种方案是可行的：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-09-22-17-16-53.png"/></p> <p>但是，这种方案不能应用到 GNE 中。这是由于这种做法，会无差别移除所有的标签。但是<code>&lt;p&gt;</code> 标签下面的<code>&lt;a&gt;</code>标签是有用的，它在用于过滤导航栏或者推荐新闻这种类型的干扰内容中会起到很大的作用。所以<code>&lt;a&gt;</code>标签必需保留。</p> <p>那么，本文标题提到的问题：<code>如何移除指定标签，但是保留它的文本，合并到父标签中？</code>应该如何解决呢？</p> <p>实际上，这个问题在 lxml 中有现成的办法解决，他就是<code>etree.strip_tags</code></p> <p>使用方法如下：</p> <p>在本文的例子中，解决方案如下：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-09-22-17-26-23.png"/></p> <p>需要注意的是，<code>etree.strip_tags()</code>会直接修改原始Dom 树，不需要返回修改结果。</p> <p>GNE 的其他关键技术，将会在接下来的文章中逐一放出，你也可以访问GNE 的 Github 主页：<a href="https://github.com/kingname/GeneralNewsExtractor" rel="noopener" target="_blank">https://github.com/kingname/GeneralNewsExtractor</a>，提前阅读项目源代码。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    