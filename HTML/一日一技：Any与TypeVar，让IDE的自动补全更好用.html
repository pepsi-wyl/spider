 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>相信有很多同学在写Python的时候，会使用类型标注来提高代码的可读性，同时还能帮助IDE实现自动补全。</p> <p>假设我们现在获得了一个对象，这个对象可能是列表也可能是生成器，我写一个函数，获取它的第一个元素。代码很简单：</p> <p>代码写好了，但是当我获取第一个元素，想打印它里面的数据的时候，我发现我忘记了People这个类有哪些属性了，而此时PyCharm的自动补全也失效了，我不得不把代码往回翻，去寻找People定义的位置，效率非常低。如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220528174322.png"/></p> <p>如果我们使用了类型标注，就能解决这个问题：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220528174204.png"/></p> <p>这个常规用法，大家肯定都知道。</p> <p>现在问题来了，我们除了<code>People</code>类，还有<code>Cat</code>类，并且列表里面的元素可能全是<code>People</code>类的实例，也可能全是<code>Cat</code>类实例，这种情况怎么办呢？</p> <p>首先你遇到了第一个问题，<code>get_first_element</code>的参数的类型标注怎么写？</p> <p>你可能会写成这样：</p> <p>那如果还有一个<code>Dog</code>类呢？</p> <p>为了简化操作，你可能会用<code>Any</code>，类型，于是<code>get_first_element</code>变成了下面这样：</p> <p>现在你发现问题又来了，PyCharm的自动补全又坏了。因为Any是任何类型，所以在代码运行前，它其实不知道你返回的是什么东西。如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220528174553.png"/></p> <p>这种情况下，你就需要使用Python类型标注中的<code>泛型</code>了。我们知道，泛型是静态语言中的概念，Python由于使用了类型标注，也有了类型。于是也就借用了这个概念。</p> <p>我们来看看怎么使用它：</p> <p>注意这里的变量名<code>T</code>和TypeVar的参数<code>'T'</code>可以同时写成任意字符串，但变量名要与参数保持一致。例如：</p> <p>然后把T当做<code>Any</code>一样使用就可以。我们来看看效果：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220528173945.png"/></p> <p>可以看到，PyCharm又能自动补全了。使用<code>TypeVar</code>，可以告诉PyCharm，返回的类型跟传入参数中的<code>T</code>对应位置的类型保持一致。例如传入参数中，<code>T</code>在<code>List[T]</code>或者<code>Generator[T]</code>中，所以返回的参数需要与列表中的元素或者生成器中的元素类型保持一致。</p> <p>我们用Cat生成器来测试一下，发现也能自动补全：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220528172546.png"/></p> <p>还有更厉害的，如果我的列表里面既有<code>Cat</code>的实例，又有<code>People</code>的实例怎么办？这个时候，PyCharm会直接把两个实例的可能补全都给你列出来：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220528172902.png"/></p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    