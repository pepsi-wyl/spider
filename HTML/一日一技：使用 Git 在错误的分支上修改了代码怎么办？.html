 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>我们知道，在使用 Git 的时候，应该要正确使用它的分支（Branch）功能。不同的功能使用不同的分支开发，最后合并进入主分支。但有时候会出现这样一种情况——我代码都已经写完了，才发现我写错分支了。这个时候，怎么把我的修改迁移到目标分支上，并且不修改现在正在使用的分支？</p> <p>我们用一个简单的例子来说明这种情况。</p> <p>首先创建一个文件夹：<code>test_git</code>，并且在里面创建一个1.txt 文件，这个文件的内容如下：</p> <p>如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-03-26.png"/></p> <p>接下来，我执行命令<code>git init</code>，把当前文件夹作为一个git 源，并把1.txt 提交到源里面，让 git 进行管理。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-04-45.png"/></p> <p>现在，我基于当前分支，创建一个<code>dev</code>分支。并对新分支里面的1.txt 文件进行修改：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-06-15.png"/></p> <p>好了，现在准备工作做完了。我现在有两个分支<code>master</code>和<code>dev</code>。每个分支里面都有一个叫做<code>1.txt</code>的文件。并且这两个<code>1.txt</code>文件的内容前半截相同，后半截不同。</p> <p>大家可以看到，我现在在 dev 分支上。这个时候，我想修改 master 分支上面的1.txt。但是我忘记切换分支了。于是直接修改了dev 分支上的1.txt：</p> <p><img alt="红框中的内容，原本是想在 master 分支修改的" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-08-23.png"/></p> <p>这个时候，如果我直接使用命令<code>git checkout master</code>试图切换分支，git 会报错，没有办法切过去：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-09-24.png"/></p> <p>很多人可能会这样做：打开一个记事本，把1.txt 里面修改的内容记录下来。然后使用命令<code>git checkout -- 1.txt</code>恢复1.txt 到修改之前的内容。然后切换到 master 分支。再根据记事本里面记录的修改内容，把代码粘贴到1.txt 文件中。如果只有1个文件修改那还好。但是在软件开发中，可能你修改了很多个文件。所以这种方法会变得非常笨拙。</p> <p>但实际上，git 早就预料到了你有这个需求，所以它已经有了应对方案。我们现在回到刚刚在 dev 分支修改了1.txt 的时候：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-12-08.png"/></p> <p>这个时候，<strong>千万不要</strong>执行<code>git add</code>命令。</p> <p>你只需要按顺序执行如下三条命令：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-13-52.png"/></p> <p>然后，我们打开1.txt 文件：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2021-07-02-20-15-00.png"/></p> <p>可以看到，刚才的修改已经自动应用到了master 分支的1.txt 上面了。</p> <p><code>git stash</code>会把当前修改的内容缓存起来，并恢复当前工作区到你修改之前的状态。然后切换回 master 分支，执行命令<code>git stash pop</code>，把刚才的修改应用到 master 分支的1.txt 文件中。如果不出现冲突，那么它会自动修改1.txt 文件。如果出现了冲突，那么需要你打开1.txt 文件以后，手动解除冲突。</p> <p>可以看到，使用<code>git stash</code>命令，比你单独手动记录修改的内容，切换分支再重新改一遍要方便很多。</p> <p>更多 Git 相关的小技巧，大家可以在微软提供的学习网站进行学习：<a href="https://docs.microsoft.com/en-us/learn/modules/intro-to-git/?WT.mc_id=DT-MVP-5003916" rel="noopener" target="_blank">Introduction to Git - Learn | Microsoft Docs</a></p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    