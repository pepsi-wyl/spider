 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在Python中，如果要判断一个字符串是否在另一个字符串里面，我们可以使用<code>in</code>关键字，例如：</p> <p>如果有多个句子和多个关键字，那么可以使用<code>for</code>循环来实现：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-03-02-12-18-39.png"/></p> <p>现在如果有100000000个句子，有1000个关键字，那么你需要对比1000亿次才能全部查询完成。这个时间代价太大了，如果Python一秒钟能运行500万次查询（实际上没有这么快），那么1000亿次查询需要20000秒，接近6小时。而且，由于<code>in</code>关键字的时间复杂度为<code>O(n)</code>，如果有大量长句子，查询时间会更长。</p> <p>例如，我们要从下面的句子里面寻找<code>CNM</code>。</p> <p>如果使用常规方法，那么我们的做法是：</p> <p>于是就知道了，<code>CNM</code>在sentences列表下标为4和7的这两个句子中。</p> <p>下面，我们换一个看起来更笨的办法：</p> <p>要找到<code>CNM</code>在哪几句里面，可以变成：寻找<code>C</code>、<code>N</code>、<code>M</code>这三个字母在哪几句里面。然后，再找到同时有这三个字母的句子:</p> <p>所以，{4 7} 与 {4 6 7} 与 {4 5 7}做交集，得到{4 7}说明<code>CNM</code>这个词很有可能是在第4句和第7句。</p> <p>为什么说很可能呢？因为假如再添加一句话：<code>今天我们学习三个单词：Cat Network Morning</code>。这一句也会被认为包含<code>CNM</code>这个词，但实际上它只是同时包含了<code>C</code>、<code>N</code>、<code>M</code>三个字母而已。</p> <p>接下来，有人会问了：原来直接查询<code>CNM</code>的时候，只需要查询8次就可以了。现在你分别查询<code>C</code> <code>N</code> <code>M</code>要查询24次。你是修复了查询时间太短的bug吗？</p> <p>回答这个问题之前，我们再来看另一个问题。</p> <p>Python里面，当我要判断字母<code>C</code>是不是在句子<code>我不想听到有人说CNM！</code>里面时，Python是如何工作的？</p> <p>实际上，它的工作原理可以写成：</p> <p>如果要判断<code>C</code>、<code>N</code>、<code>M</code>是不是都在这个字符串<code>我不想听到有人说CNM！</code>中，同一个字符串会被遍历3次。有没有办法减少这种看起来多余的遍历操作呢？</p> <p>如果我们把<code>我不想听到有人说CNM！</code>这个句子转成字典会怎么样：</p> <p>这样一来，只需要在生成字典的时候遍历句子一次，减少了2次冗余遍历。并且，判断一个元素是否在字典里面，时间复杂度为<code>O(1)</code>，速度非常快。</p> <p><code>我不想听到有人说CNM！</code>生成的字典为<code>{'我': 1 '不': 1 '想': 1 '听': 1 '到': 1 '有': 1 '人': 1 '说': 1 'C': 1 'N': 1 'M': 1 '！': 1}</code>。那么如果要把列表里面的所有句子都这样处理，又怎么存放呢？此时，字典的Key就是每一个字符，而Value可以是每一句话在原来列表中的索引：</p> <p>生成的字典为：</p> <p>生成的字典这么长，看起来非常可怕。但是别慌，毕竟不是你人肉寻找。对Python来说，字典里面无论有多少个Key，它的查询时间都是一样的。</p> <p>现在，我们要寻找<code>C</code>、<code>N</code>、<code>M</code>，于是代码可以写为：</p> <p>运行结果如下：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-03-02-13-50-58.png"/></p> <p>所以，对于一组需要被查询的关键字，也可以这样搜索：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-03-02-14-05-33.png"/></p> <p>看完这篇文章以后，你已经学会了倒排索引（Inverted-index）。这是Google搜索的核心算法之一。</p> <p>可以看出，对于少量数据的搜索，倒排索引并不会比常规方法节约多少时间。但是当你有100000000条句子，1000个关键词的时候，用倒排索引实现搜索，所需要的时间只有常规方法的1/10甚至更少。</p> <p>最后回到前面遇到的一个问题，当句子里面同时含有字母<code>C</code>、<code>N</code>、<code>M</code>，虽然这三个字母并不是组合在一起的，也会被搜索出来。这就涉及到搜索引擎的另一个核心技术——<code>分词</code>了。对于英文而言，使用空格来切分单词就好了。但是对于中文来说，不同的汉字组合在一起构成的词语，字数是不一样的。甚至有些专有名词，可能七八个字，但是也要作为整体来搜索。</p> <p>分词的具体做法，又是另外一个故事了。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    