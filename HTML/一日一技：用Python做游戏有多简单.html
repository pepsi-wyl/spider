 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>我520的公众号图片发了以后，有很多同学问我这个游戏是怎么做的，难不难。我就用两篇文章来介绍一下，如果使用Python做游戏。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220520111927.png"/></p> <p>这个游戏是使用PyGame做的，贴图素材是从<a href="https://itch.io/game-assets" rel="noopener" target="_blank">itch.io</a>找的。我之前也没有用过PyGame，这次属于是现学现用，参考的教程是<a href="https://realpython.com/pygame-a-primer" rel="noopener" target="_blank">PyGame: A Primer on Game Programming in Python</a>。</p> <p>用PyGame做游戏非常简单，我们今天第一篇文章，让大家实现一个可以在地图上移动的小猪。</p> <p>首先，无论你是做什么游戏，别管三七二十一，先把下面这段代码复制粘贴到你的编辑器里面。所有游戏都需要这几行代码：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521213043.png"/></p> <p>现在，我们随便找两张图片，一张作为背景，一张作为主角。尺寸不用太在意，差不多就可以了，因为我们可以用代码动态调整。下面两张图是我随便找的素材，大家注意图中红框框住的地方，是这两张图片的尺寸。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521213601.png"/></p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521213806.png"/></p> <p>我们使用如下代码加载图片：</p> <p>其中的<code>.convert_alpha()</code>是保留png图片的透明背景。如果你加载的图片不png图片，可以把<code>convert_alpha()</code>改成<code>convert()</code>。</p> <p>如果要修改图片尺寸，使用如下代码：</p> <p>要把图片显示在窗口中，使用下面两行代码：</p> <p>完整的代码如下：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521214515.png"/></p> <p>需要注意的是，<code>win.blit</code>和<code>pygame.display.flip()</code>都要放到while循环里面。其中<code>win.blit</code>的第一个参数是我们刚刚加载的素材对象。第二个参数是一个元组，标记这个图片左上角在画布上面的坐标。整个画布左上角对应坐标<code>(0 0)</code>。由于背景图的尺寸也是<code>(800 600)</code>，所以背景图的左上角放到<code>(0 0)</code>，就刚好可以铺满整个画布。</p> <p>我们做的是一个像素风格的游戏，可以到<code>itch.io</code>上面找素材：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521215428.png"/></p> <p>这个网站提高了大量的游戏素材，并且绝大部分素材，在个人非商业用途的情况下是免费的。你找到自己喜欢的素材以后，就可以直接下载，整个过程你甚至都不需要登录（比国内的垃圾素材网站可良心多了）。</p> <p>你下载了素材以后，可能会发现一件非常奇怪的事情，怎么素材全部画在一张图上？</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521215738.png"/></p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521215813.png"/></p> <p>实际上，这就是业界惯例，做素材的人会把每一类素材排列到一张图片上，你要用的时候，需要自己去裁剪。例如所有植物放在一张图上，所有雕像放在一张图上，地基贴图也放在一张图上。</p> <p>上面我们演示用的背景图，初看起来是一张绿色的图，但是它实际上包含了多个地基元素，请注意我用红框框住的部分：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521220139.png"/></p> <p>在正式游戏中，我们要把每一个基本元素拆出来，重新组合起来使用。重组的时候，有些元素要复制多份重复使用，有些元素要旋转缩放。最终组合成下面这样看起来<code>好看</code>的地图：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521220249.png"/></p> <p>一般来说，像素风格的素材，尺寸大多是<code>16x16</code>，<code>32x32</code>，<code>64x64</code>，<code>128x128</code>。素材作者正常情况下会提供裁剪说明。如果没有提供的话，你也可以肉眼观察，然后猜一猜。</p> <p>例如我要从雕像素材里面剪切出红框框住的女神像：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521220810.png"/></p> <p>那么，我可以这样写代码：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521221607.png"/></p> <p>可能有同学问：为什么女神的坐标是这样的呢？我只能说，这个坐标是我试了很多次，试出来的。</p> <p>除了背景图，我们添加的每一个元素都是一个对象，例如上面的小猪和女神像。原则上来讲，上面的代码就足够让你把游戏做得漂亮了，想加什么东西，就不停加载图片素材，然后放到合适的位置就可以了。</p> <p>但我们可以使用面向对象的设计方法，让代码更容易维护，也更简单。PyGame里面，有一个类叫做<code>Sprite</code>，我们可以为每一个对象实现一个类，继承<code>Sprite</code>，然后把对象的素材设置成<code>.surf</code>属性，把对象的位置设置为<code>.rect</code>属性。例如上面的代码，我们修改一下：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220521223325.png"/></p> <p>注意代码中的<code>all_sprites = [bg goddess pig]</code>，这里我使用的是列表。后面会有更高级的数据结构<code>SpriteGroup</code>来储存他们。今天使用列表就足够了。</p> <p><code>素材对象.get_rect()</code>会返回一个坐标定位对象，这个对象有多个属性，例如<code>.left</code> <code>.top</code> <code>.center</code> <code>.width</code> <code>.height</code>。在不传参数的情况下，默认<code>.left=0</code> <code>.top=0</code>，PyGame会自动根据这个对象的尺寸计算<code>.width</code>，<code>.height</code>和<code>.center</code>。我们可以通过传入参数的形式主动设定。当你设定左上角的时候，它自动就能算出中心点的坐标；当你传入中心坐标的时候，它自动就能算出左上角的坐标。</p> <p>理论上来讲，在每个类里面，素材对象可以用任何名字，不一定要用<code>.surf</code>。坐标定位对象也不一定要用<code>.rect</code>，只要你在<code>win.blit</code>的时候对应起来就可以了。但是如果你统一使用<code>.surf</code>和<code>.rect</code>会给你带来很多好处。这一点我们到物体碰撞那个地方再讲。因此我建议你就使用这两个名字。</p> <p>既然是游戏，那肯定要按键盘让主角动起来。否则跟一幅画有什么区别呢？大家注意<code>main()</code>函数里面的<code>while running</code>这个循环，如果你在循环里面加上一行代码：<code>print(111)</code>，你会发现当你运行这个游戏的时候，<code>111</code>会一直不停的打印出来。</p> <p>PyGame本质上，就是通过<code>win.blit</code>不停地画图，由于这个<code>while</code>循环每秒要运行很多次，如果每次运行的时候，我们让<code>win.blit</code>的第二个参数，也就是素材对象的坐标有细微的差异，那么在人眼看起来，这个素材对象就在运动了。</p> <p>我们的目标是按住键盘的上下左右方向键，小猪向4个不同的方向移动。在PyGame里面，获得键盘按住不放的键，使用如下代码实现：</p> <p>它返回的是一个长得像列表的对象（但不是列表），当我们要判断某个键是否被按下的时候，只需要判断<code>if keys[想要判断的键]</code>，如果返回<code>True</code>，说明被按住了。基于这个原理，我们来写两段代码。首先修改<code>Pig</code>类，新增一个<code>.update</code>方法：</p> <p><code>.update</code>方法接收一个参数<code>keys</code>，就是我们按键返回的长得像列表的对象。然后判断是哪个方向键被按下了。根据被按下的键，<code>.rect</code>坐标定位对象修改相应方向的值。<code>rect.move_ip</code>这里的<code>ip</code>是<code>inplace</code>的简写，也就是修改<code>.rect</code>这个属性自身。它的参数是一个元组，对应横坐标和纵坐标。横纵坐标小于0表示向左或者向上，大于0表示向右或者向下。</p> <p>原来的<code>main()</code>函数只需要在<code>win.blit</code>之前增加两行代码：</p> <p>完整代码如下：</p> <p>最后的运行效果如下面这个视频所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/pig_game.gif"/></p> <p>PyGame做游戏真的非常简单，只要会加载素材，就能做出一个还能看得过去的游戏。今天我们学会了怎么添加素材，怎么捕获键盘事件。</p> <p>PyGame可以读取Gif图片，但是你会发现加载进来以后，Gif不会动。下一篇文章，我们来讲讲如何让你控制的角色动起来，例如控制一个小娃娃，移动的时候，它的脚也跟着动。以及对象的碰撞检测。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    