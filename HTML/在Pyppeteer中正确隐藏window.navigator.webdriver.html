 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在我以前的一篇文章：<a href="https://mp.weixin.qq.com/s/TqL3OawPe9zW_nneyXvefQ" rel="noopener" target="_blank">一日一技：如何正确移除Selenium中window.navigator.webdriver的值</a>，我讲到了如何在Selenium启动的Chrome中，通过设置启动参数隐藏<code>window.navigator.webdriver</code>，驳斥了网上垃圾文章中流传的使用JavaScript注入的弊端。</p> <p>由于Selenium启动的Chrome中，有几十个特征可以被识别，所以在爬虫界已经没有以前那么受欢迎了。模拟浏览器的新秀Puppeteer异军突起，逐渐受到了爬虫界的关注。Puppeteer需要使用JavaScript来控制，如果你是用Python，那么就需要使用Pyppeteer.</p> <p>如果你使用模拟浏览器爬淘宝，你会发现，无论怎么修改参数，Selenium总是可以立刻被识别。但是如果你使用了本文的方法，用Pyppeteer抓取淘宝，你就会发现另外一个广阔的天地。</p> <p>今天，我们来讲讲如何在Pyppeteer中隐藏<code>window.navigator.webdriver</code></p> <p>首先，我们使用下面的代码，通过Pyppeteer打开浏览器窗口：</p> <p>代码运行以后，会打开Chrome浏览器，并访问<code>http://exercise.kingname.info/</code>(这是我写的爬虫练习网站，大家可以用这个网站练习爬虫开发，里面有几道题挺难^_^)</p> <p>在这个浏览器中，我们打开开发者工具，查询<code>window.navigator.webdriver</code>会发现它的值为<code>true</code>。如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-20-52-06.png"/></p> <p>网上的代码，无外乎注入JavaScript，在网页自带的JavaScript加载之前，提前运行一段JavaScript，修改查询<code>window.navigator.webdriver</code>的接口。</p> <p>这种方式每开一个新页面都要执行一次，繁琐，愚蠢！</p> <p>那么正确的办法是什么呢？</p> <p>我写这篇文章的时候（2019-08-15），Pyppeteer的最新版本为0.0.25，如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-21-08-18.png"/></p> <p>此时，你可以在PyCharm中，按住Command键（Windows、Linux用户按住Ctrl键），鼠标左键点击<code>from pyppeteer import launch</code>中的<code>launch</code>，自动跳转到Pyppeteer源代码中的<code>launcher.py</code>文件。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-21-10-30.png"/></p> <p>把代码往上翻，在第60行左右，找到如下图方框框住的代码：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-21-10-59.png"/></p> <p>把<code>--enable-automation</code>这一行注释掉。此时PyCharm会提示你是否修改源代码，选择OK。如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-21-11-33.png"/></p> <p>修改完成以后的代码如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-21-12-38.png"/></p> <p>以上就是你需要做的全部修改。</p> <p>重新运行刚才的代码，你会发现，<code>window.navigator.webdriver</code>已经是<code>undefined</code>了。如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-21-14-09.png"/></p> <p>在Pyppeteer即将发布的0.0.26版本的功能里面，我看到了如下图方框框住的一项：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-08-15-21-15-39.png"/></p> <p>所以，等0.0.26版本发布以后，我们就可以直接通过传递参数来禁用<code>--enable-automation</code>了，不再需要修改源代码了。</p> <p>题外话：官方文档和源代码是你的好朋友，如果官方文档找不到你想要的功能，源代码又看不懂，那么就来关注我的公众号吧。长按下面的二维码关注我：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/wechatplatform.jpg"/></p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    