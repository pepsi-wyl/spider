 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>MarkdownPicPicker 是基于Python3 的Markdown写作辅助工具， 作者是我。它能将剪贴板中的图片上传到网络图床中，并将markdown格式的图片链接(![](&lt;图片地址&gt;))复制到剪贴板中。</p> <p>项目地址：<a href="https://github.com/kingname/MarkdownPicPicker" rel="noopener" target="_blank">https://github.com/kingname/MarkdownPicPicker</a></p> <p>第0.2版有以下功能：</p> <p>配置文件保存在<code>config.ini</code>文件中，其意义分别如下：<br/><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/></pre></td><td class="code"><pre><span class="line"><span class="section">[basic]</span></span><br/><span class="line"><span class="attr">run_method</span> = bat <span class="comment"># 设定程序的运行方式，bat为使用bat文件触发，global_listen为全局键盘监听方式</span></span><br/><span class="line"><span class="attr">picture_folder</span> = pic <span class="comment">#设定程序的运行方式，bat为使用bat文件触发，pyHook为全局键盘监听方式</span></span><br/><span class="line"><span class="attr">picture_suffix</span> = png <span class="comment">#截图的保存格式，可以选择bmp或者png</span></span><br/><span class="line"><span class="comment"># now support qiniu only</span></span><br/><span class="line"><span class="attr">picture_bed</span> = qiniu</span><br/><span class="line"></span><br/><span class="line"><span class="section">[global_listen]</span></span><br/><span class="line"><span class="attr">short_key_one</span> = Lwin <span class="comment">#快捷键第一个按键</span></span><br/><span class="line"><span class="attr">short_key_two</span> = C <span class="comment">#快捷键第二个按键</span></span><br/><span class="line"></span><br/><span class="line"><span class="section">[qiniu]</span></span><br/><span class="line"><span class="comment">#七牛云的相关配置</span></span><br/><span class="line"><span class="attr">access_key</span> = Q6sS422O05AwYD5aVqM3FqCcCpF36tqvyQ75Zvzw</span><br/><span class="line"><span class="attr">secret_key</span> = <span class="number">6</span>QtAqqTxoSxZP-<span class="number">2</span>uoXROehxPLX2CCmoOaB2aLObM</span><br/><span class="line"><span class="attr">container_name</span> = picturebed  <span class="comment">#七牛云的图片储存位置</span></span><br/><span class="line"><span class="attr">url</span> = https://kingname-<span class="number">1257411235</span>.cos.ap-chengdu.myqcloud.com/{} <span class="comment">#七牛云分配的默认域名</span></span><br/></pre></td></tr></table></figure></p> <p>其中<code>access_key</code> 和 <code>secret_key</code> 可以在七牛云的控制面板中看到，如图：<br/><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20160605083025.png"/><br/><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2016-06-04-20-22-43.png"/> </p> <p><code>container_name</code> 为下图所示内容：<br/><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2016-06-04-20-24-40.png"/> </p> <p><code>short_key_one</code> 和 <code>short_key_two</code> 为快捷键的两个按键，默认为左侧windows徽标键(<code>Lwin</code>) 和 字母 <code>C</code>。</p> <p>将程序配置好以后运行，创建一个批处理文件markdownpicpicker.bat 其内容如下：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">@echo off</span><br/><span class="line">cmd /k "G:\github\MarkdownPicPicker\venv\Scripts\activate &amp; cd /d G:\github\MarkdownPicPicker &amp; python MarkdownPicPicker.py &amp; deactivate &amp; exit"</span><br/></pre></td></tr></table></figure></p> <p>路径请根据实际情况修改。</p> <p>由于我使用了virtualenv 所以需要在批处理中进入virtualenv的环境才能正常运行程序。对于将requirements.txt里面包含的库直接安装在全局的情况，bat 可以简化：</p> <p>不论哪种方式，均不要在任何相关的路径上出现中文，否则会导致不可预知的问题。</p> <p>然后右键选择批处理，发送到桌面快捷方式。接着右键快捷方式，属性，在“快捷键” 这一栏按下字母Q，它将自动填充为 <code>Ctrl + Alt + Q</code> 确定。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2016-06-05-00-45-03.png"/> </p> <p>只需要首先使用QQ截图或者其他截图工具将图片保存到剪贴板中，然后按下设定好的快捷键即可。Markdown格式的图片链接就已经保存到剪贴板中了。在需要使用的地方直接粘贴。</p> <p>不过这样设定的快捷键，按下以后会有大概一秒钟的延迟。推荐大家使用AutoHotKey来触发这个bat文件。</p> <p>本程序使用了Pillow库中的 <code>ImageGrab.grabclipboard()</code> 方法来获取剪贴板中的数据，但是由于这个方法有一个bug 导致可能会爆以下错误：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">Unsupported BMP bitfields layout</span><br/></pre></td></tr></table></figure></p> <p>这个问题从Pillow 2.8.0开始，一直到3.2.0都没有被官方解决。目前有一个间接的解决办法。<br/>请打开Python安装目录下的\Lib\site-packages\PIL\BmpImagePlugin.py文件，将以下代码：</p> <p>修改为：<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/></pre></td><td class="code"><pre><span class="line">if file_info['bits'] in SUPPORTED:</span><br/><span class="line">    if file_info['bits'] == 32 and file_info['rgba_mask'] in SUPPORTED[file_info['bits']]:</span><br/><span class="line">        raw_mode = MASK_MODES[(file_info['bits'] file_info['rgba_mask'])]</span><br/><span class="line">        self.mode = "RGBA" if raw_mode in ("BGRA") else self.mode</span><br/><span class="line">    elif file_info['bits'] in (24 16) and file_info['rgb_mask'] in SUPPORTED[file_info['bits']]:</span><br/><span class="line">        raw_mode = MASK_MODES[(file_info['bits'] file_info['rgb_mask'])]</span><br/><span class="line">    '''新增内容开始'''</span><br/><span class="line">    elif file_info['bits'] == 32 and file_info['rgb_mask'] == (0xff0000 0xff00 0xff):</span><br/><span class="line">        pass</span><br/><span class="line">    '''新增内容结束'''</span><br/><span class="line">    else:</span><br/><span class="line">        raise IOError("Unsupported BMP bitfields layout")</span><br/><span class="line">else:</span><br/><span class="line">    raise IOError("Unsupported BMP bitfields layout")</span><br/></pre></td></tr></table></figure></p> <p>就能解决本问题。</p> <p>本程序还有一个功能是全局监听键盘，通过特殊的快捷键组合就可以直接触发读取图片上传图片的操作。但是由于这个功能使用到了pyHook这个库。但是这个库在设计上存在缺陷，如果当前窗体的标题包含Unicode字符时，会导致Python崩溃。因此这个功能默认不启动。</p> <p>如果不清楚某个键盘按键对应的字符串是什么样子的，可以运行QueryKey.py这个文件，运行以后按下某个键，控制台上就会显示相应的信息。其中<code>Key</code>就是可以设置到<code>SHORT_KEY_ONE</code>和<code>SHORT_KEY_TWO</code>的内容。如图为按下键盘左Shift键以后显示的信息。<br/><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2016-06-04-23-14-30.png"/> </p> <p><strong>本文首发地址-&gt; <a href="http://kingname.info/2016/06/04/markdownPicPicker/" rel="noopener" target="_blank">http://kingname.info/2016/06/04/markdownPicPicker/</a> 转载请注明出处</strong></p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    