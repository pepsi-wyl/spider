 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>在之前的文章：<a href="https://mp.weixin.qq.com/s/eGji_6PBkf-vK2SQPB0WTQ" rel="noopener" target="_blank">一日一技：使用装饰器简化大量 if…elif…代码</a>发布以后，有很多同学说想看后续，如何在装饰器中表示大于小于。甚至有同学每周来催一次稿：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/IMG_0672.jpg"/></p> <p>于是，今天我们就来看看大于小于应该怎么来判断。为了实现我们今天的目标，有两个前置知识需要掌握，一个是Python自带的<code>operator</code>模块，另一个是偏函数。</p> <p>当我们要表达<code>大于</code>这个意思的时候，你想到的肯定是大于符号<code>&gt;</code>。所以<code>2大于1</code>，肯定写作<code>2 &gt; 1</code>。这看起来是很正常的事情。现在，如果我让你不准使用大于符号<code>&gt;</code>，怎么表示大于？</p> <p>实际上，在Python里面，除了<code>&gt;</code>外，还有一种写法，就是使用自带的<code>operator</code>模块：</p> <p>其中的<code>.gt(参数1 参数2)</code>就表示<code>参数1 &gt; 参数2</code>。如果成立，返回<code>True</code>，否则返回<code>False</code>。</p> <p>类似的还有：</p> <p>因此，下面两个写法是等价的：</p> <p>我在很久以前的公众号文章里面已经介绍过偏函数了：<a href="https://mp.weixin.qq.com/s/veP19kUQgnyiivDoJH8_9g" rel="noopener" target="_blank">偏函数：在Python中设定默认参数的另一种办法</a>。因此本文就不再讲它的基础用法了，大家点击链接去看那篇文章就可以掌握。</p> <p>为什么我们需要偏函数呢？这是因为我们今天要做的事情，它需要给函数先传一半的参数，另一半的参数要在未来才能传入。例如，循环等待用户输入数字，如果其中一次输入的数字大于等于5，就打印<code>你好世界</code>。</p> <p>如果不知道偏函数，你可能是这样写的：</p> <p>有了偏函数以后，你的写法是这样的：</p> <p>特别注意，这里我在偏函数中传入的第一个参数是<code>operator.le</code>：小于。因为<code>operator.xx</code>表示第一个参数对第二个参数的比较，所以<code>x &gt;= 5</code> 就相当于5 &lt;= x 也就是<code>operator.le(5 x)</code>。</p> <p>前置知识掌握以后，我们就能看如何在装饰器里面实现大小比较。在第一篇文章中，我们只实现了参数等于，它的原理是：</p> <p><code>register</code>只接收了一个位置参数<code>value</code>。但实际上，我们还可以通过修改这段注册的代码，实现如下的效果：</p> <p>有同学问，有没有可能实现这样的写法呢：</p> <p>我觉得这样写是没有什么必要的。因为<code>register()</code>里面，多个参数之间的关系是<code>且</code>。那么只有两种情况，要么，就等于这个数，例如<code>@get_discount.register(2 le=3)</code>，既要等于2，又要小于等于3，那显然就等于2。不需要写这个<code>le=3</code>。要么，就不存在结果，例如<code>@get_discount.register(2 gt=3)</code>，既要等于2，又要大于3，显然下面被装饰的函数永远不会执行。因为找不到这个数。</p> <p>因此，我们的装饰器函数就可以做如下修改：</p> <p>它的使用方法还是跟以前一样，先定义默认的函数逻辑：</p> <p>如果定义相等的逻辑，写法跟以前完全一样：</p> <p>如果要定义不等于逻辑，就在<code>.register()</code>中添加一个参数<code>op</code>：</p> <p>运行效果如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/20220315203458.png"/></p> <p>由于我们定义了大于2时，始终返回1，所以可以看到<code>get_discount(6)</code>和<code>get_discount(10)</code>返回的都是1.</p> <p>由于我们只定义了等于1和大于2的逻辑，所以当传入的参数为2时，就返回<code>等级错误</code>.</p> <p>到这里，本文要讲的内容就结束了。但最后还是要考大家3个问题：</p> <p>你可以试一试在不实用偏函数和<code>operator</code>的情况下，实现这个需求。</p> <p>例如对于下面的两个函数：</p> <p>当level的值是20的时候，同时满足两个条件，应该运行哪一个呢？</p> <p>怎么实现这样的功能：</p> <p>如果区间存在全包含、部分包含应该运行哪个函数？例如：</p> <p>请大家把你对这两个问题的答案回答在评论区里面。提示（想清楚什么是真需求，什么是伪需求，再考虑怎么解决）</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    