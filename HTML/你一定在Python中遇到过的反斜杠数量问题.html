 
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
    <p class="site-subtitle">给时光以生命。</p> <p>大家在开发Python的过程中，一定会遇到很多反斜杠的问题，很多人被反斜杠的数量搞得头大。</p> <p>首先我们写一段非常简单的Python代码，它的作用是把一个字段先转换为JSON格式的字符串，然后把这个字符串再转换为JSON格式的字符串：</p> <p>它的运行效果如下图所示。</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-03-17-22-44-51.png"/></p> <p>第一次，字典转成JSON格式的字符串，只有中文<code>杭州</code>变成了Unicode编码<code>\u676d\u5dde</code>，其余地方没有出现反斜杠。</p> <p>在Python里面，反斜杠不能单独出现，这里<code>\u676d\u5dde</code>中的两根反斜杠，实际上应该是<code>\u</code>。表示这两个编码是Unicode编码。</p> <p>接下来，把第一次生成的JSON字符串：<code>{"name": "kingname" "address": "\u676d\u5dde" "salary": 99999}</code>再一次转成JSON格式的字符串，这一次变成了：</p> <p>为什么突然出现了这么多反斜杠？这是因为，JSON格式的字符串本身是使用双引号来表示字符串的。如果原来的字符串里面本身就有双引号，那就会导致混淆。此时，Python需要把原来字符串的双引号变成普通的字符，失去双引号的作用。因此使用<code>\"</code>让双引号变成普通的字符。</p> <p>这就相当于在Python中，可以这样定义一个包含双引号的字符串：</p> <p>这里，<code>你好</code>两侧的双引号都加上了反斜杠，让它成为普通的字符，防止它们提前与最外层的双引号配对。</p> <p>如果不加反斜杠，就会导致字符串里面的双引号提前与外层的双引号配对，引起语法错误：</p> <p>这里，<code>"跟我说："</code>成为了一个字符串，末尾的<code>""</code>成为了一个空字符串。那么中间的<code>你好</code>就变成了一个没有定义的变量。而Python里面，是不存在<code>字符串未定义的变量字符串</code>这种写法的，所以会报语法错误。</p> <p>而JSON格式的字符串，本质上也是字符串，所以自然而然也需要遵循这样的规则。因此，字符串原来自带的双引号左侧就被加上了反斜杠。</p> <p>那么，原来的<code>\u676d\u5dde</code>为什么变成了<code>\\u676d\\u5dde</code>？</p> <p>这是因为，当第二次执行<code>json.dumps</code>的时候，传入的参数是一个JSON格式的字符串，本质就是字符串。而一个字符串里面如果自带反斜杠，那么JSON在对他再次转换的时候，需要标记这是一个普通的字符串形式的反斜杠，不是一个有特殊意义的反斜杠，所以使用<code>\\</code>表示一个普通的反斜杠。</p> <p>好了，那么你可以猜一下，如果把<code>info_json_json</code>再<code>json.dumps</code>一下会怎么样？</p> <p>会变成：</p> <p>为什么出现了三个反斜杠连用和四个反斜杠连用的问题？</p> <p>实际上非常简单，当你对<code>info_json_json</code>执行<code>json.dumps</code>的时候，Python是怎么转换的？</p> <p>我们来看：</p> <p>对<code>字符串</code>执行<code>json.dumps</code>的时候，记住一个关键方法——从左到右，一个字符一个字符的转换。</p> <p>全部执行完成了，由于这次转换是把一个字符串转换为JSON格式的字符串，所以最外侧加上双引号。</p> <p>于是就得到了：</p> <p>我们在爬虫开发过程中，可能会遇到上面这种经过多次JSON转换后的字符串，此时，千万不要轻易使用字符串的<code>.replace</code>方法把多个反斜杠替换为空或者把两个反斜杠替换为一个反斜杠。那样做只会导致你的数据更难解析。</p> <p>正确的做法应该是尝试对数据一层一层使用<code>json.loads</code>，把它一层一层还原，还原到最初的<code>{'name': 'kingname' 'address': '杭州' 'salary': 99999}</code>这种简单形式。</p> <p>好了，今天的介绍就到这里，最后留一个思考题：</p> <p>还是上面的代码，现在把PyCharm的调试模式打开，然后数一数<code>info_json</code>和<code>info_json_json</code>里面反斜杠的个数，如下图所示：</p> <p><img alt="" src="https://kingname-1257411235.cos.ap-chengdu.myqcloud.com/2019-03-17-23-38-30.png"/></p> <p>为什么在<code>info_json</code>里面，出现了<code>\\u676d\\u5dde</code>，为什么在<code>info_json_json</code>里面双引号前是两根反斜杠，而<code>\"\\u676d\\u5dde\"</code>竟然变成了<code>\\"\\\\u676d\\\\u5dde</code>。</p> <p>请关注公众号，下一篇文章为你解答。</p> <p class="site-author-name" itemprop="name">谢乾坤 | Kingname</p> <p class="site-description motion-element" itemprop="description">高级数据挖掘工程师，《Python 爬虫开发 从入门到实战》、《左手 MongoDB 右手 Redis——从入门到商业实战》作者。 微软最有价值专家 MVP，Python Scrapy MongoDB Redis Pandas Golang。</p>
    </body>
    </html>
    